<h1 id="fcnd---3d-motion-planning">FCND - 3D Motion Planning</h1>
<figure>
<img src="./misc/enroute.png" alt="Quad Image" />
<figcaption aria-hidden="true">Quad Image</figcaption>
</figure>
<p>This project is a continuation of the Backyard Flyer project where
you executed a simple square shaped flight path. In this project you
will integrate the techniques that you have learned throughout the last
several lessons to plan a path through an urban environment. Check out
the <a href="https://review.udacity.com/#!/rubrics/1534/view">project
rubric</a> for more detail on what constitutes a passing submission.</p>
<h2
id="option-to-do-this-project-in-a-gpu-backed-virtual-machine-in-the-udacity-classroom">Option
to do this project in a GPU backed virtual machine in the Udacity
classroom!</h2>
<p>Rather than downloading the simulator and starter files you can
simply complete this project in a virual workspace in the Udacity
classroom! Follow <a
href="https://classroom.udacity.com/nanodegrees/nd787/parts/5aa0a956-4418-4a41-846f-cb7ea63349b3/modules/0c12632a-b59a-41c1-9694-2b3508f47ce7/lessons/5f628104-5857-4a3f-93f0-d8a53fe6a8fd/concepts/ab09b378-f85f-49f4-8845-d59025dd8a8e?contentVersion=1.0.0&amp;contentLocale=en-us">these
instructions</a> to proceed with the VM.</p>
<h2
id="to-complete-this-project-on-your-local-machine-follow-these-instructions">To
complete this project on your local machine, follow these
instructions:</h2>
<h3 id="step-1-download-the-simulator">Step 1: Download the
Simulator</h3>
<p>This is a new simulator environment!</p>
<p>Download the Motion-Planning simulator for this project that’s
appropriate for your operating system from the <a
href="https://github.com/udacity/FCND-Simulator-Releases/releases">simulator
releases respository</a>.</p>
<h3 id="step-2-set-up-your-python-environment">Step 2: Set up your
Python Environment</h3>
<p>If you haven’t already, set up your Python environment and get all
the relevant packages installed using Anaconda following instructions in
<a href="https://github.com/udacity/FCND-Term1-Starter-Kit">this
repository</a></p>
<h3 id="step-3-clone-this-repository">Step 3: Clone this Repository</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/udacity/FCND-Motion-Planning</span></code></pre></div>
<h3 id="step-4-test-setup">Step 4: Test setup</h3>
<p>The first task in this project is to test the <a
href="https://github.com/udacity/FCND-Motion-Planning/blob/master/backyard_flyer_solution.py">solution
code</a> for the Backyard Flyer project in this new simulator. Verify
that your Backyard Flyer solution code works as expected and your drone
can perform the square flight path in the new simulator. To do this,
start the simulator and run the <a
href="https://github.com/udacity/FCND-Motion-Planning/blob/master/backyard_flyer_solution.py"><code>backyard_flyer_solution.py</code></a>
script.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> activate fcnd <span class="co"># if you haven&#39;t already sourced your Python environment, do so now.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> backyard_flyer_solution.py</span></code></pre></div>
<p>The quad should take off, fly a square pattern and land, just as in
the previous project. If everything functions as expected then you are
ready to start work on this project.</p>
<h3 id="step-5-inspect-the-relevant-files">Step 5: Inspect the relevant
files</h3>
<p>For this project, you are provided with two scripts,
<code>motion_planning.py</code> and <code>planning_utils.py</code>. Here
you’ll also find a file called <code>colliders.csv</code>, which
contains the 2.5D map of the simulator environment.</p>
<h3
id="step-6-explain-whats-going-on-in-motion_planning.py-and-planning_utils.py">Step
6: Explain what’s going on in <code>motion_planning.py</code> and
<code>planning_utils.py</code></h3>
<p><code>motion_planning.py</code> is basically a modified version of
<code>backyard_flyer.py</code> that leverages some extra functions in
<code>planning_utils.py</code>. It should work right out of the box. Try
running <code>motion_planning.py</code> to see what it does. To do this,
first start up the simulator, then at the command line:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> activate fcnd <span class="co"># if you haven&#39;t already sourced your Python environment, do so now.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> motion_planning.py</span></code></pre></div>
<p>You should see the quad fly a jerky path of waypoints to the
northeast for about 10 m then land. What’s going on here? Your first
task in this project is to explain what’s different about
<code>motion_planning.py</code> from the
<code>backyard_flyer_solution.py</code> script, and how the functions
provided in <code>planning_utils.py</code> work.</p>
<h3 id="step-7-write-your-planner">Step 7: Write your planner</h3>
<p>Your planning algorithm is going to look something like the
following:</p>
<ul>
<li>Load the 2.5D map in the <code>colliders.csv</code> file describing
the environment.</li>
<li>Discretize the environment into a grid or graph representation.</li>
<li>Define the start and goal locations. You can determine your home
location from <code>self._latitude</code> and
<code>self._longitude</code>.</li>
<li>Perform a search using A* or other search algorithm.</li>
<li>Use a collinearity test or ray tracing method (like Bresenham) to
remove unnecessary waypoints.</li>
<li>Return waypoints in local ECEF coordinates (format for
<code>self.all_waypoints</code> is [N, E, altitude, heading], where the
drone’s start location corresponds to [0, 0, 0, 0]).</li>
</ul>
<p>Some of these steps are already implemented for you and some you need
to modify or implement yourself. See the <a
href="https://review.udacity.com/#!/rubrics/1534/view">rubric</a> for
specifics on what you need to modify or implement.</p>
<h3 id="step-8-write-it-up">Step 8: Write it up!</h3>
<p>When you’re finished, complete a detailed writeup of your solution
and discuss how you addressed each step. You can use the <a
href="./writeup_template.md"><code>writeup_template.md</code></a>
provided here or choose a different format, just be sure to describe
clearly the steps you took and code you used to address each point in
the <a
href="https://review.udacity.com/#!/rubrics/1534/view">rubric</a>. And
have fun!</p>
<p>The figure below shows the path in red found using A* search using
direct and diagonal actions in a 1mx1m grid of the environment. <img
src="./AStar-Diagonal-RayTrace.png" alt="Example Image" /></p>
<p>The movie of the drone tracking the path is shown below.</p>
<video controls width="600">
<source src="./astar_diag_raytrace.mo" type="video/quicktime">
<p>Your browser does not support the video tag. </video></p>
<h2 id="extra-challenges">Extra Challenges</h2>
<p>The submission requirements for this project are laid out in the
rubric, but if you feel inspired to take your project above and beyond,
or maybe even keep working on it after you submit, then here are some
suggestions for interesting things to try.</p>
<h3 id="try-flying-more-complex-trajectories">Try flying more complex
trajectories</h3>
<p>In this project, things are set up nicely to fly right-angled
trajectories, where you ascend to a particular altitude, fly a path at
that fixed altitude, then land vertically. However, you have the
capability to send 3D waypoints and in principle you could fly any
trajectory you like. Rather than simply setting a target altitude, try
sending altitude with each waypoint and set your goal location on top of
a building!</p>
<h3 id="adjust-your-deadbands">Adjust your deadbands</h3>
<p>Adjust the size of the deadbands around your waypoints, and even try
making deadbands a function of velocity. To do this, you can simply
modify the logic in the <code>local_position_callback()</code>
function.</p>
<h3 id="add-heading-commands-to-your-waypoints">Add heading commands to
your waypoints</h3>
<p>This is a recent update! Make sure you have the <a
href="https://github.com/udacity/FCND-Simulator-Releases/releases">latest
version of the simulator</a>. In the default setup, you’re sending
waypoints made up of NED position and heading with heading set to 0 in
the default setup. Try passing a unique heading with each waypoint. If,
for example, you want to send a heading to point to the next waypoint,
it might look like this:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define two waypoints with heading = 0 for both</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>wp1 <span class="op">=</span> [n1, e1, a1, <span class="dv">0</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>wp2 <span class="op">=</span> [n2, e2, a2, <span class="dv">0</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set heading of wp2 based on relative position to wp1</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>wp2[<span class="dv">3</span>] <span class="op">=</span> np.arctan2((wp2[<span class="dv">1</span>]<span class="op">-</span>wp1[<span class="dv">1</span>]), (wp2[<span class="dv">0</span>]<span class="op">-</span>wp1[<span class="dv">0</span>]))</span></code></pre></div>
<p>This may not be completely intuitive, but this will yield a yaw angle
that is positive counterclockwise about a z-axis (down) axis that points
downward.</p>
<p>Put all of these together and make up your own crazy paths to fly!
Can you fly a double helix?? <img src="./misc/double_helix.gif"
alt="Double Helix" /></p>
<p>Ok flying a double helix might seem like a silly idea, but imagine
you are an autonomous first responder vehicle. You need to first fly to
a particular building or location, then fly a reconnaissance pattern to
survey the scene! Give it a try!</p>
